local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local LocalPlayer = Players.LocalPlayer
local Mouse = LocalPlayer:GetMouse()

local gui = Instance.new("ScreenGui", game.CoreGui)
gui.Name = "AimLockUI"

-- Nút bật/tắt
local toggleBtn = Instance.new("TextButton")
toggleBtn.Size = UDim2.new(0, 80, 0, 40)
toggleBtn.Position = UDim2.new(0.5, -40, 0.1, 0)
toggleBtn.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
toggleBtn.TextColor3 = Color3.new(1, 1, 1)
toggleBtn.Text = "off"
toggleBtn.Font = Enum.Font.GothamBold
toggleBtn.TextScaled = true
toggleBtn.Parent = gui
toggleBtn.Active = true
toggleBtn.Draggable = true

-- Thông báo bật lock với tên
local function showLockNotification(targetName)
	local notif = Instance.new("Frame")
	notif.Size = UDim2.new(0, 290, 0, 70)
	notif.Position = UDim2.new(1, -300, 1, -90)
	notif.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
	notif.BorderSizePixel = 0
	notif.AnchorPoint = Vector2.new(0, 1)
	notif.Parent = gui
	notif.ZIndex = 10
	notif.BackgroundTransparency = 0.1 -- **Đã chỉnh sửa: Giảm độ trong suốt của khung thông báo**

	local stroke = Instance.new("UIStroke", notif)
	stroke.Color = Color3.fromRGB(255, 255, 255)
	stroke.Thickness = 1.5

	local icon = Instance.new("TextLabel", notif)
	icon.Text = "⚠️"
	icon.Size = UDim2.new(0, 40, 1, 0)
	icon.Position = UDim2.new(0, 5, 0, 0)
	icon.BackgroundTransparency = 1
	icon.Font = Enum.Font.GothamBold
	icon.TextColor3 = Color3.new(1, 1, 1)
	icon.TextScaled = true

	local title = Instance.new("TextLabel", notif)
	title.Text = "Camlock"
	title.Font = Enum.Font.GothamBold
	title.TextColor3 = Color3.fromRGB(255, 255, 255)
	title.TextXAlignment = Enum.TextXAlignment.Left
	title.Size = UDim2.new(1, -50, 0.4, 0)
	title.Position = UDim2.new(0, 50, 0, 5)
	title.BackgroundTransparency = 1
	title.TextScaled = true

	local content = Instance.new("TextLabel", notif)
	content.Text = "Locked onto: " .. targetName
	content.Font = Enum.Font.Gotham
	content.TextColor3 = Color3.fromRGB(255, 255, 255) -- **Đã chỉnh sửa: Chuyển sang màu trắng tinh khiết**
	content.TextXAlignment = Enum.TextXAlignment.Left
	content.Size = UDim2.new(1, -50, 0.4, 0)
	content.Position = UDim2.new(0, 50, 0.55, 0)
	content.BackgroundTransparency = 1
	content.TextScaled = true

	local tweenIn = TweenService:Create(notif, TweenInfo.new(0.4), {Position = notif.Position - UDim2.new(0, 0, 0, 20)})
	tweenIn:Play()

	task.wait(3)

	local tweenOut = TweenService:Create(notif, TweenInfo.new(0.3), {
		Position = notif.Position + UDim2.new(0, 0, 0, 20),
		BackgroundTransparency = 1
	})
	tweenOut:Play()
	tweenOut.Completed:Wait()
	notif:Destroy()
end

-- ESP
local function createESP(target)
	local box = Instance.new("BoxHandleAdornment")
	box.Adornee = target
	box.AlwaysOnTop = true
	box.ZIndex = 5
	box.Size = target.Size + Vector3.new(0.5, 0.5, 0.5)
	box.Transparency = 0.5
	box.Color3 = Color3.new(1, 0, 0)
	box.Parent = target
	return box
end

local aimlockEnabled = false
local currentTarget = nil
local espBox = nil

-- Toggle Lock
toggleBtn.MouseButton1Click:Connect(function()
	aimlockEnabled = not aimlockEnabled
	toggleBtn.Text = aimlockEnabled and "on" or "off"

	if aimlockEnabled then
		currentTarget = nil
	end

	if not aimlockEnabled then
		currentTarget = nil
		if espBox then espBox:Destroy() espBox = nil end
	end
end)

-- Tìm người gần chuột
local function getClosestPlayer()
	local closest, shortestDist = nil, math.huge
	for _, player in ipairs(Players:GetPlayers()) do
		if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
			local pos = workspace.CurrentCamera:WorldToScreenPoint(player.Character.HumanoidRootPart.Position)
			if pos.Z > 0 then
				local dist = (Vector2.new(pos.X, pos.Y) - Vector2.new(Mouse.X, Mouse.Y)).Magnitude
				if dist < shortestDist then
					shortestDist = dist
					closest = player
				end
			end
		end
	end
	return closest
end

-- Aim lock mỗi khung hình
RunService.RenderStepped:Connect(function()
	if aimlockEnabled then
		if not currentTarget or not currentTarget.Character or not currentTarget.Character:FindFirstChild("HumanoidRootPart") then
			currentTarget = getClosestPlayer()
			if espBox then espBox:Destroy() espBox = nil end
			if currentTarget and currentTarget.Character then
				showLockNotification(currentTarget.Name)
				espBox = createESP(currentTarget.Character:FindFirstChild("HumanoidRootPart"))
			end
		end

		if currentTarget and currentTarget.Character and currentTarget.Character:FindFirstChild("HumanoidRootPart") then
			workspace.CurrentCamera.CFrame = CFrame.new(
				workspace.CurrentCamera.CFrame.Position,
				currentTarget.Character.HumanoidRootPart.Position
			)
		end
	end
end)
